# -*-python-*-

import os
Import ('env')
#sources = env['src_glob'] (env, '*.mf')
sources = env['glob'] (env, '*.mf')

fonts = reduce (lambda x, y: x + y,
		map (lambda x: env['glob'] (env, x),
		     ('feta[0-9]*.mf',
		      'feta-braces-[a-z].mf',
		      'feta-din*[0-9].mf',
		      'feta-nummer*[0-9].mf',
		      'parmesan[0-9]*.mf',)))

env.Depends ('mf', 'mf-essential')
stems = fonts #map (lambda x: os.path.splitext (x)[0], fonts)

t = map (env.TFM, stems)
a = map (env.AFM, stems)
p = map (env.PFA, stems)

map (lambda x: env.Depends (x + '.pfa', x + '.enc'), stems)

mf_essential = ['feta16', 'feta20', 'parmesan16', ]
pfa_essential = map (env.PFA, mf_essential)
env.Alias ('mf-essential', pfa_essential)

env.Alias ('mf', 'mf-essential')

env.Command ('cmr.enc', 'cmr.enc.in', 'cp $SOURCE $TARGET')
env.Alias ('mf', 'cmr.enc')
env.Alias ('mf', p)

tfmdir = os.path.join (env['lilypondprefix'], 'fonts/tfm')
afmdir = os.path.join (env['lilypondprefix'], 'afm')
pfadir = os.path.join (env['lilypondprefix'], 'fonts/type1')
ti = map (lambda x: env.Install (tfmdir, x), t)
ai = map (lambda x: env.Install (afmdir, x), a)
pi = map (lambda x: env.Install (pfadir, x), p)
env.Alias ('install', tfmdir)
env.Alias ('install', afmdir)
env.Alias ('install', pfadir)
