<!--
    Translation of GIT committish: <FILL-IN-HEAD-COMMITTISH>  

    When revising a translation, copy the HEAD committish of the
    version you're working on. Use

      git-rev-list HEAD  |head -1

    to discover that.
!-->

<h2>Beautiful numbers</h2> 
	
How do we actually make formatting decisions?  In other words, which
of the three configurations should we choose for the following slur?

<p>

<img src="@IMAGES@slur-esthetics.png">

<p>

There are a few books on the art of music engraving
available. Unfortunately, they contain rules of simple thumbs and some
examples.  Such rules can be instructive, but they are a far cry from
an algorithm that we could readily implement in a computer.  Following
the instructions from literature leads to algorithms with lots of
handcoded exceptions. Doing all this case analysis is a lot of work,
and often not all cases are covered completely.

<p align="center">
<img src="@IMAGES@ross-beam-scan.jpeg" align="center"></p>
<p align="center">

<em>Formatting rules defined by example. Image from Ted Ross' The Art of
Music Engraving</em>
</p>

<p>
We have developed a much easier and robust method of determining the
best formatting solution: score based formatting. The principle is the
same as a beauty contest: for each possible configuration, we compute an
ugliness score. Then we choose the least ugly configuration.

<p>

<img src="@IMAGES@slur-esthetics-annotate-1.png">

<p>

For example, in the above configuration, the slur nicely connects the
starting and ending note of the figure, a desirable trait. However, it
also grazes one note head closely, while staying away from the others.
Therefore, for this configuration, we deduct a `variance' score of
15.39.

<p>

<img src="@IMAGES@slur-esthetics-annotate-2.png">
<p>

In this configuration, the slur keeps a uniform distance from the
heads, but we have to deduct some points because the slur doesn't
start and end on the note heads.  For the left edge, we deduct 1.71,
and for the right edge (which is further from the head) we deduct 9.37
points.

Furthermore, the slur goes up, while the melody goes down. This incurs
a penalty of 2.00 points

<p>

<img src="@IMAGES@slur-esthetics-annotate-3.png">

<p>

Finally, in this configuration, only the ending the slur is far away
from the ending note head, at a score of 10.04 ugliness points.

<p>
Adding up all scores, we notice that the third option is the least
ugly, or most beautiful version.   Hence we select that one.

<p>

This technique is a general technique, and it is used in a lot of
situations, for example

<ul>
<li> determining beam slopes
<p>

<img src="@IMAGES@beam-scoring-example.png">
<li> formatting tied chords

<p>
<img src="@IMAGES@ties-scoring-example.png">
<li> formatting dotted chords
<li> line breaking
<li> page breaking  
</ul>
<p>

This technique evaluates a lot of possibilities, which takes some time
to compute. However, that is a worthwhile expense, because the end
result is much better, and because it makes our lives easy.


<p align=right>
Next: <a href=benchmarking.html>Man is the measure of things</a>: is a
flexible architecture enough?
