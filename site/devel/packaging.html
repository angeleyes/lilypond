<h1> Packaging instructions</h1>

Please help by compiling and packing up LilyPond, and we will link to
your site.

<h2>Debian</h2>

<p>
  To ensure the creation of the lilypond deb is trouble-free, it is
  recommended that you first install the following packages by running
  apt-get as root before building the package

  <pre>
    apt-get install\
    bison flex fontforge g++ gettext groff gs guile-1.6-dev\
    imagemagick libc6-dev libfontconfig1-dev libfontconfig1-dev\
    libfreetype6-dev libfreetype6-dev libgtk2.0-dev libkpathsea-dev\
    libpango1.0-dev libpango1.0-dev m4 mftrace netpbm potrace python\
    t1utils tetex-bin tetex-extra texinfo
  </pre>
</p>

<p>
  The build scripts are in the subdirectory <code>debian/</code>; you
  can make the .deb by doing
  <pre>
    tar xzf lilypond-x.y.z.tar.gz
    cd lilypond-x.y.z
    dpkg-checkbuilddeps           # print missing build dependencies
    # apt-get install ...         # install any missing packages
    dch -p -v x.y.z.local.1 "Local build."
    debuild
  </pre>
</p>

<p>
  If you are real impatient, you may even do
  <pre>
    cd lilypond-x.y.z   # a previous version
    uscan               # download and build latest directly from upstream
  </pre>
</p>


<h2>Fedora</h2>

<p>
  A spec file is in
  <code>make/out/lilypond.fedora.spec</code>. This file is distributed along
  with the sources.  You can make the rpm by issuing
  <pre>    
    tar zxf lilypond-x.y.z.tar.gz
    mkdir -p $(rpm --eval=%_sourcedir) $(rpm --eval=%_builddir)
    cp lilypond-x.y.z.tar.gz $(rpm --eval=%_sourcedir)
    rpmbuild -bb lilypond-x.y.z/make/out/lilypond.fedora.spec
  </pre>
</p>

<p>
  For building as non-root user, add the following to <code>~/.rpmmacros</code>,
  <pre>
    %_topdir %(eval echo $HOME)/usr/src/rpm
  </pre>

  <!-- we have other spec files for non fedora systems.-->

</p>

<p>
  For compilation on a Fedora system you need these packages, in
  addition to the those needed for running.  Nowadays, there is no
  need anymore to hunt down and resolve dependencies by hand.  It is
  recommended to run yum as root
  <pre>
    yum install\
    autotrace bison flex gcc-c++ glibc-devel groff guile-devel\
    libstdc++-devel mftrace netpbm-progs t1utils texinfo\
    pango-1.6.0-devel fontconfig-devel
  </pre>
  Optionally, for the gnome backend
  <pre>
    yum install gtk2-devel
  </pre>
</p>


<h2>Mandrake</h2>

<p>
  You can also compile a RPM for Mandrake yourself.  A spec file is
  in <code>make/out/lilypond.mandrake.spec</code>, see the instructions
  for building the Fedora RPM.</a>
</p>

<h2>SuSE</h2>

A spec file is in <code>make/out/lilypond.suse.spec</code>, see the
instructions building the Fedora RPM.</a>

<p>
  You must have the following packages: guile tcsh tetex te_latex
  te_kpath te_mpost libpng python gpp libgpp gettext autoconf netpbm
  libnetpb gs_serv gs_lib gs_fonts guile
</p>


<h2>Windows</h2>


<h3>Requirements</h3>

<p>
  To build LilyPond for Windows, you need to install
  the <code>Cygwin</code> tools. out the
  <a href="http://cygwin.com">Cygwin webpage</a>.
</p>

<h4>Native compiling</h4>

<ul>
  <li>Install Cygwin packages required for running and building as
    suggested by <code>cygwin/README.in</code>.
  </li>
  <li>Install additional packages for building the documentation:
    <ul>
      <li>autotrace</li>
      <li>t1utils</li>
      <li>mftrace</li>
      <li>fontforge</li>
    </ul>
    The packages autotrace, t1utils and mftrace are not included in
    Cygwin, but compile out of the box.  fontforge for Cygwin can be
    downloaded from <a href="http://fontforge.sourceforge.net/">fontforge's
      sourceforge page</a>.
  </li>
  <li>Tell Cygwin to circumvent DOS/Windows command line restrictions:
    <pre>
      mount -f -X c:/cygwin/bin /bin
      mount -f -x c:/cygwin/bin/strace.exe /bin/strace.exe
      mount -f -x c:/cygwin/bin/cygcheck.exe /bin/cygcheck.exe
  </pre></li>
  <li>Install mknetrel:
    <pre>
      cd /
      cvs -d:pserver:anoncvs@sources.redhat.com:/cvs/cygwin-apps \
      co -d netrel mknetrel
  </pre></li>
  <li>Get and setup LilyPond source:
    <pre>
      mkdir -p /netrel/src && cd /netrel/src
      mkdir -p old
      wget -P/tmp http://lilypond.org/download/v2.3/lilypond-2.3.25.tar.gz
      PATH=/netrel/bin:$PATH pimport lilypond</pre>
    You can also pull from CVS, but the important thing is to
    have lilypond 2.3.25 or newer, and just one directory named
    `lilypond-x.y.z-r'.
  </li>
  <li>If you build from CVS, you must generate the configure script, do: <pre>
      cd lilypond-x.y.z-r && NOCONFIGURE=x ./autogen.sh
  </pre></li>
  <li>Build the package:
    <pre>
      cp lilypond-2.3.25-1/cygwin/mknetrel /netrel/extra/lilypond
      /netrel/bin/mknetrel lilypond
  </pre></li>
</ul>

<h4>Cross compiling</h4>

To cross compile for Cygwin:

<ul>
  <li>Make sure you can build LilyPond for your build host, including
    the documentation.  See instructions for GNU/Linux platforms above.
  </li>
  <li>Cross compiling for Windows on a GNU/Linux box is done with
    mknetrel.
    To get and install it, do something like: <pre>
      sudo mkdir -p /netrel
      sudo chown $USER /netrel
      cd /
      cvs -d:pserver:anoncvs@sources.redhat.com:/cvs/cygwin-apps \
      co -d netrel mknetrel
    </pre>
  </li>
  <li>
    Setup a binary Cygwin environment.  There is a handy command line
    
    <a href="http://lilypond.org/cygwin/cyg-apt">cyg-apt</a> script that
    can set it up and help keep it up to date.  Do something like:  <pre>
      wget -P ~/bin http://lilypond.org/cygwin/cyg-apt
      chmod +x ~/bin/cyg-apt
      sudo mkdir -p /cygwin
      sudo chown $USER /cygwin
      cyg-apt setup
      cyg-apt update
      cyg-apt --no-deps install cygwin flex gettext guile-devel libguile12 \
      libintl2 libkpathsea3 python tetex-devel w32api
    </pre>
  </li>
  <li>
    Create a Cygwin cross building environment.
    You can get

    <a href="http://lilypond.org/cygwin/debian/dists/unstable">precompiled toolchain
      gcc-i686-cygwin binaries for Debian GNU/Linux i386</a>.  Add to your
    /etc/apt/sources.list: <pre>
      deb http://lilypond.org/cygwin/debian unstable .
    </pre> Do: <pre>
      apt-get update
      apt-get install binutils-i686-cygwin gcc-i686-cygwin
    </pre>
  </li>
  <li>Install LilyPond source and use mknetrel build instructions as
    described in section native compiling above.
  </li>
</ul>

