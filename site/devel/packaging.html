<h1> Packaging instructions</h1>

Please help us by compiling and packing up Lily, and we will link to
your site.


<h2>RedHat</h2>

A spec file is in
<code>make/out/lilypond.redhat.spec</code>. This file is distributed along
with the sources.  You can make the rpm by issuing
<p>
<pre>     
        cp lilypond-x.y.z.tar.gz /usr/src/redhat/SOURCES/
        tar xfz lilypond-x.y.z.tar.gz
     	rpmbuild -bb lilypond-x.y.z/make/out/lilypond.redhat.spec
     </pre>

<p>For compilation on a Red Hat system you need these packages, in
addition to the those needed for running: glibc-devel, gcc-c++,
libstdc++-devel, guile-devel, flex, bison, texinfo, groff, mftrace,
netpbm-progs, autotrace, t1utils.



<h2>Mandrake</h2>

<p>You can also compile a RPM for Mandrake yourself.  A spec file is
in <code>make/out/lilypond.mandrake.spec</code>, see the instructions
for building the Red Hat RPM.</a>


<h2>SuSE</h2>

A spec file is in <code>make/out/lilypond.suse.spec</code>, see the
instructions building the Red Hat RPM.</a>

<p>You must have the following packages: guile tcsh tetex te_latex
te_kpath te_mpost libpng python gpp libgpp gettext autoconf netpbm
libnetpb gs_serv gs_lib gs_fonts guile



<h2>Debian</h2>

<p>If you're real impatient, you may even do:
<pre>     
     	cd lilypond-x.y.z   # a previous version
             uscan               # download and build latest directly from upstream
     </pre>

   <p>The build scripts are in the subdirectory <code>debian/</code>; you can
make the .deb by doing, for example:

<pre>       $ su - root
       # dpkg --purge lilypond lilypond1.3
       # exit
       $ tar xzf lilypond-1.8.0.tar.gz
       $ cd lilypond-1.8.0
       $ dch -p -v 1.8.0-0.local.1 "Local build."
       $ debuild -B
       $ su - root
       # dpkg -i ../lilypond_1.8.0-*.deb
       # exit
       $
</pre>

<p>
To ensure the creation of the lilypond deb is
trouble-free, we recommend that you first install the following packages
by running apt-get as root before building the package:

<p>
For Debian 3.0:
<pre>  
       apt-get install g++ libc6-dev \
               python guile-1.6-dev tetex-bin libkpathsea-dev \
               tetex-extra flex bison texinfo groff gs \
               netpbm m4 gettext mftrace pfaedit autotrace t1utils
</pre>


<h2>Windows</h2>


<h3>Requirements</h3>

<p>To build LilyPond for Windows, you need to install
<code>the GNU + Cygnus tools, 1.5.5 or newer<code>.
Check out the <a href="http://cygwin.com">Cygwin webpage</a>. 
You can get the latest version of the GNU + Cygnus tools from a Cygwin
<a href="http://cygwin.com/mirrors.html">mirror site</a>.

<p>
Currently, LilyPond packages for Cygwin are built on a Debian GNU/Linux host,
see the section cross compiling below.


<h4>Native compiling</h4>

We just had a first <a href="http://mail.gnu.org/archive/html/lilypond-devel/2003-08/msg00118.html">success report</a>

from Józsa Márton, who compiled LilyPond 1.9.0 on cygwin-1.3.22.  (Note
that cygwin-1.3.x is no longer supported; upgrade to cygwin-1.5.5 or newer.)

<ul>
  <li>Install Cygwin packages required for building:<br>
  autoconf (for builds from CVS)
  bash
  binutils
  bison
  cvs
  cygwin
  fileutils
  flex
  gcc
  ghostscript
  guile-devel
  libguile12
  libkpathsea3
  libreadline5
  perl
  python
  sed
  sh-utils
  tetex-bin
  tetex-devel
  tetex-tiny
  texinfo
  </li>
  <li>Install additional packages for building the documentation:
    <ul>
      <li>autotrace</li>
      <li>t1utils</li>
      <li>mftrace</li>
      <li>pfaedit</li>
    </ul>
    The packages autotrace, t1utils and mftrace are not included in
    Cygwin, but compile out of the box.  pfaedit for Cygwin can be
    <a href="http://pfaedit.sourceforge.net/pfaedit_cygwin-030827.tgz">
      downloaded</a> from <a href="http://pfaedit.sf.net">pfaedit's
      sourceforge page</a>.
    </li>
  <li>Tell Cygwin to circumvent DOS/Windows command line restrictions:
    <pre>
      mount -f -X c:/cygwin/bin /bin
      mount -f -x c:/cygwin/bin/strace.exe /bin/strace.exe
      mount -f -x c:/cygwin/bin/cygcheck.exe /bin/cygcheck.exe
    </pre></li>
  <li>Install mknetrel:
    <pre>
      cd /
      cvs -d:pserver:anoncvs@sources.redhat.com:/cvs/cygwin-apps \
        co -d netrel mknetrel
    </pre></li>
  <li>Get and setup LilyPond source:
    <pre>
   mkdir -p /netrel/src && cd /netrel/src
   mkdir -p old
   wget -P/tmp http://lilypond.org/download/v1.9/lilypond-1.9.9.tar.gz
   PATH=/netrel/bin:$PATH pimport lilypond</pre>
    You can also pull from CVS, but the important thing is to
    have lilypond 1.9.9 or newer, and just one directory named
    `lilypond-x.y.z-r'.
  </li>
  <li>If you build from CVS, you must generate the configure script, do: <pre>
    cd lilypond-x.y.z-r && NOCONFIGURE=x ./autogen.sh
  </pre></li>
  <li>Build the package:
    <pre>
      cp lilypond-1.9.9-1/cygwin/mknetrel /netrel/extra/lilypond
      /netrel/bin/mknetrel -xX lilypond
  </pre></li>
</ul>

<h4>Cross compiling</h4>

Current LilyPond releases are cross compiled on a GNU/Linux box.  To
cross compile for Cygwin:

<ul>
  <li>Make sure you can build LilyPond for your build host, including
    the documentation.  See instructions for GNU/Linux platforms above.
  </li>
  <li>Cross compiling for Windows on a GNU/Linux box is done with
    mknetrel.
    To get and install it, do something like: <pre>
      sudo mkdir -p /netrel
      sudo chown $USER /netrel
      cd /
      cvs -d:pserver:anoncvs@sources.redhat.com:/cvs/cygwin-apps \
        co -d netrel mknetrel
    </pre>
  </li>
  <li>
  Setup a binary Cygwin environment.  There is a bare bones
  
  <a href="http://lilypond.org/cygwin/cyg-apt">cyg-apt</a> script that
  can set it up and help keep it up to date.  Do something like:  <pre>
    wget -P ~/bin http://lilypond.org/cygwin/cyg-apt
    chmod +x ~/bin/cyg-apt
    sudo mkdir -p /cygwin
    sudo chown $USER /cygwin
    cyg-apt setup
    cyg-apt update
    cyg-apt --no-deps install cygwin flex gettext guile-devel libguile12 \
        libintl2 libkpathsea3 python tetex-devel w32api
  </pre>
  </li>
  <li>
    Create a Cygwin cross building environment.
    You can get

    <a href="http://lilypond.org/debian/dists/unstable">precompiled toolchain
      gcc-i686-cygwin binaries for Debian GNU/Linux i386</a>.  Add to your
      /etc/apt/sources.list: <pre>
      deb http://lilypond.org/download/binaries/debian unstable .
    </pre> Do: <pre>
      apt-get update
      apt-get install binutils-i686-cygwin gcc-i686-cygwin
    </pre>
  </li>
  <li>Install LilyPond source and use mknetrel build instructions as
    described in section native compiling above.
  </li>
</ul>
    
