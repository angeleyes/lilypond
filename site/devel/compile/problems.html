<h1>Problems</h1>

<h2>Compiling</h2>

<h4> I upgraded by applying a patch, and now my configure/build breaks.</h4>

Patches don't include automatically generated files, i.e. &lsquo;configure&rsquo; and files generated by &lsquo;configure&rsquo;. Regenerate them yourself:
<pre>
      ./autogen.sh
      ./configure
</pre>

You can also consider using the xdelta files: it is the safest method
for upgrading. The .xd files are for <a
href=ftp://ftp.xcf.berkeley.edu/pub/xdelta/>xdelta</a> 1.1.1)

The following command produces lilypond-1.1.55.tar.gz from lilypond-1.1.54 identical (up to compression dates) to the .55 on the FTP site.

<pre>
xdelta patch lilypond-1.1.54-1.1.55.xd lilypond-1.1.54.tar.gz
</pre>

<h4>How do I create the &lsquo;.tfm&rsquo; files?</h4>

You don't. The &lsquo;.tfm&rsquo; files should be generated automatically by Metafont when you run TeX. If they&rsquo;re not, check your TeX installation, or ask your local TeX guru.

The supplied &lsquo;.afm&rsquo; files are intended to be used by LilyPond, not by any other programs.


<h4>Linking to kpathsea</h4>

   <p>If kpathsea and the corresponding header files are installed in some
directory where GCC does not search by default, for example in
<code>/usr/local/lib/</code> and <code>/usr/local/include/</code> respectively,
you have to explicitly tell configure where to find it. To do this,

     <ul>
<li><code>rm config.cache</code>
<li><code>export LDFLAGS=-L/usr/share/texmf/lib</code>
<li><code>export CPPFLAGS=-I/usr/share/texmf/include</code>
<li><code>./configure</code>
</ul>
   Once configure has found them, the paths are stored in
<code>config.make</code> and will be used even if you don't have the
environment variables set during make.



<h4><a name="TOC5"></a>Font problems.</h4>

   <p>If you are upgrading from a previous version of LilyPond, be sure to
remove all old font files. These include <code>.pk</code> and <code>.tfm</code> files
that may be located in <code>/var/lib/texmf</code>, <code>/var/spool/texmf</code>,
<code>/var/tmp/texmf</code> or <code><var>prefix</var>/share/lilypond/fonts/</code>.  A
script automating this has been included, see
<code>buildscripts/clean-fonts.sh</code>.



<h4><a name="TOC26"></a>Flex-2.5.4a and gcc-3.x</h4>

   <p>Flex 2.5.4a does not produce g++-3.0 compliant C++ code.  To compile
LilyPond with gcc-3.0 you may do:

<pre>             CC=gcc-3.0 CXX=g++-3.0 ./configure --enable-config=gcc-3.0
             make conf=gcc-3.0 -C lily out-gcc-3.0/lexer.cc
             patch -p1 &lt; lexer-gcc-3.0.patch
             make conf=gcc-3.0 -C lily
     </pre>

   <p>Note that this is fixed in Debian/unstable for flex &gt;= 2.5.4a-13.

<h4><a name="TOC27"></a>Flex-2.5.4a and gcc-3.1.x</h4>

   <p>Flex 2.5.4a does not produce g++-3.1.1 compliant C++ code.  To compile
LilyPond with gcc-3.1.1 you may do:

<pre>             CONF=gcc-3.1 ./lexer-gcc-3.1.sh
             CPPFLAGS=-I$(pwd)/lily/out-gcc-3.1 CC=gcc-3.1 CXX=g++-3.1 \
                 ./configure --enable-config=gcc-3.1
             CONF=gcc-3.1 ./lexer-gcc-3.1.sh
             make conf=gcc-3.1
     </pre>

   <p>This assumes that the GCC 3.1 binaries are called gcc-3.1 and g++-3.1. 
Note that this is <strong>not</strong> fixed in Debian/unstable for flex &lt;=
2.5.4a-26.
<h4><a name="TOC22"></a>compiling on MacOS X</h4>

   <p>To make sure you have all packages needed to build LilyPond installed,
run as root:

<pre> apt-get install bash python guile debianutils flex bison texinfo \
 ghostscript6 netpbm m4 gettext
     </pre>

   <p>and:

<pre>             fink install tetex
     </pre>

   <p>For more information about <code>apt-get</code> and <code>fink</code>, see
<a href="http://fink.sf.net">fink.sourceforge.net</a>.

   <p>Then, configure, patch, make and install LilyPond using these commands:

<pre>             CC="cc -I/sw/include" CXX="c++ -I/sw/include" LDFLAGS="-L/sw/lib" \
                 ./configure --prefix=/sw
             make -C lily out/parser.hh out/parser.cc out/config.h
             patch -p0 &lt; darwin.patch
             make -C lily out/parser.o
             make DEPENDENCIES_OUTPUT=/dev/null all
             make install
     </pre>

   <p>For installing, you must be root, of course.

   
<h4><a name="TOC29"></a>OpenBSD</h4>

By default, gcc on OpenBSD doesn't include
<code>/usr/local/include</code> and <code>/usr/local/lib</code> in the system
paths.  Depending upon where/how you installed kpathsea and other
libraries, you may need to refer to the section "Linking to
kpathsea".
<p>
The stack-protection feature of OpenBSD seems to have caused problems
in the past. Compile LilyPond without stack-protection, by adding
<tt>-fno-stack-protector</tt> to <tt>CXXFLAGS</tt>.

<h4><a name="TOC30"></a>NetBSD</h4>

     <ul>
<li>The flex precompiled in NetBSD-1.4.2 is broken. 
Download flex-2.5.4a, build, install.

     <li>The configuration of Gcc (egcs-2.91.60 19981201 (egcs-1.1.1
release)) does not include <code>/usr/pkg</code> paths.  Configure using:
     <pre>          
          CFLAGS='-I /usr/pkg/include' LDFLAGS='-L/usr/pkg/lib' ./configure
          
          </pre>

   </ul>

<h4><a name="TOC31"></a>Solaris</h4>

     <ul>
<li>Solaris7, ./configure

     <p><code>./configure</code> needs a POSIX compliant shell.  On Solaris7,
<code>/bin/sh</code> is not yet POSIX compliant, but <code>/bin/ksh</code> or bash
is.  Please run configure like:
     <pre>                  CONFIG_SHELL=/bin/ksh ksh -c ./configure
          </pre>
     or
     <pre>                  CONFIG_SHELL=/bin/bash bash -c ./configure
          </pre>

     <li>Sparc64/Solaris 2.6, GNU make-3.77

     <p>GNU make-3.77 is buggy on this platform, upgrade to 3.78.1 or newer.

     </p><li>Sparc64/Solaris 2.6, ld

     <p>Not yet resolved. 
</ul>

<h4><a name="TOC32"></a>AIX</h4>

     <ul>
<li>AIX 4.3 ld

     <p>The following is from the gcc install/SPECIFIC file. 
<blockquote>
   Some versions of the AIX binder (linker) can fail with a relocation
   overflow severe error when the -bbigtoc option is used to link
   GCC-produced object files into an executable that overflows the TOC. 
   A fix for APAR IX75823 (OVERFLOW DURING LINK WHEN USING GCC AND
   -BBIGTOC) is available from IBM Customer Support and from its
   27service.boulder.ibm.com website as PTF U455193.

          <p>Binutils does not support AIX 4.3 (at least through release 2.9). GNU
   as and GNU ld will not work properly and one should not configure GCC
   to use those GNU utilities. Use the native AIX tools which do
   interoperate with GCC. 
</blockquote>

     <p>add -Wl,-bbigtoc to USER_LDFLAGS, ie:
     <pre>              LDFLAGS='-Wl,-bbigtoc' ./configure
          </pre>

   </ul>



