# -*-Makefile-*-
# title	   specific top level makefile for LilyPond  

# subdir level:
#
depth = .
#

# descent order into subdirectories:
#
SUBDIRS = scripts buildscripts  flower lily mf midi2ly po debian \
	Documentation ly input tex make mutopia intl $(builddir)/stepmake\
	ps  scm
#

SCRIPTS = configure aclocal.m4
README_FILES =  DEDICATION COPYING NEWS TODO CHANGES ROADMAP
README_TXT_FILES = AUTHORS.txt README.txt INSTALL.txt 
IN_FILES := $(wildcard *.in)
EXTRA_DIST_FILES = dstreamrc lilypond-mode.el vimrc VERSION $(README_FILES)  $(SCRIPTS) $(IN_FILES) 
NON_ESSENTIAL_DIST_FILES = $(README_TXT_FILES)

# bootstrap stepmake:
#
STEPMAKE_TEMPLATES=toplevel yolily-toplevel po
include $(depth)/make/stepmake.make 
#

website: fonts htmldoc examples doc++

fonts:
	$(MAKE) -C $(depth)/mf 

doc:
	$(MAKE) -C Documentation

htmldoc: 
	$(MAKE) out='www' local-WWW
	$(MAKE) out='www' -C Documentation WWW
	rm -f `find . -name \*.html~ -print`
	$(footify-all-command)
	find `find Documentation -type d -name 'out-www'` -not -name '*dvi' -not -name '*ly' -not -name '*tex' -not -name '*.ps' -not -name 'out-www'  > wwwlist
	tar cfz $(outdir)/htmldoc.tar.gz  `cat wwwlist` `ls *.png $(ERRORLOG)`  index.html

examples:
	$(MAKE) out='www' -C input WWW
	$(MAKE) out='www' -C mutopia WWW
	$(footify-all-command)
	$(PYTHON) $(buildscripts)/mutopia-index.py -o short-examples.html input/
	$(PYTHON) $(buildscripts)/mutopia-index.py -o long-examples.html mutopia/

	tar --exclude='*.dvi' --exclude='*.tex' --exclude='*.ps' --exclude='*.ppm' -czf $(outdir)/examples.tar.gz *-examples.html  `find input mutopia -type d -name 'out-www' -print`

localinstall:
	mkdir -p $(datadir)
	rm -f $(datadir)/cmtfm 
	$(LN_S) $(TEX_TFMDIR) $(datadir)/cmtfm

local-WWW-clean:
	$(SHELL) $(depth)/buildscripts/clean-fonts.sh

