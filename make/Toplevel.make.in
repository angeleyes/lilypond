# -*-Makefile-*-
# @configure_input@
########################################################
# project  LilyPond -- the musical typesetter
# title	   top level makefile for LilyPond  
# file	   Makefile 
#
# Copyright (c) 1997 by    
#   	Jan Nieuwenhuizen <jan@digicash.com>
#	Han-Wen Nienhuys <hanwen@stack.nl>

# subdir level:
#
depth = .
#

# identify module:
#
NAME = lilypond
include VERSION
include ./$(depth)/make/Version.make

# generic variables:
#
include ./$(depth)/make/Variables.make 
#

# descent order into subdirectories:
#
SUBDIRS = flower lib lily mf mi2mu \
	Documentation bin init input tex make
#

# list of distribution files:
#
SCRIPTS = configure configure.in install-sh aclocal.m4
README_FILES = BUGS DEDICATION ANNOUNCE COPYING ONEWS NEWS README TODO \
	INSTALL.text AUTHORS.text
EXTRA_DISTFILES = .dstreamrc VERSION $(README_FILES) $(SCRIPTS) $(SYMLINKS)

# do not dist ./Makefile (is copied from make/Toplevel.make)
DISTFILES:=$(EXTRA_DISTFILES)# Makefile $(ALL_SOURCES)
#


# generic targets and rules:
#
include ./$(depth)/make/Targets.make
include ./$(depth)/make/Rules.make
#

localdist: configure

INSTALL.text: check-doc-deps
	rm -f INSTALL.text
	ln `$(FIND) ./ -name INSTALL.text|head -1` .

# all machine generated junk resides in out/
distclean: 
	set -e; for i in `find -type d -name 'out'`; do \
		rm -f $$i/*; done		
	rm -rf *-build-dir
	rm -f Makefile config.cache config.status config.log



localclean:
	rm -f core config.cache config.log config.status 
	rm -f $(outdir)/*.{class,html,gif}

Makefile: make/Toplevel.make.in
	echo '# WARNING WARNING WARNING WARNING' > $@
	echo '# do not edit! this is generated from make/Toplevel.make.in' >> $@
	cat $< >> $@

