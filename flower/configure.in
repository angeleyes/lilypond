dnl -*-shell-script-*-
dnl Process this file with autoconf to produce a configure script.-

AC_INIT(choleski.cc)

. $srcdir/VERSION
FULL_VERSION=$MAJOR_VERSION.$MINOR_VERSION.$PATCH_LEVEL
if test x$MY_PATCH_LEVEL != x; then
	FULL_VERSION=$FULL_VERSION.$MY_PATCH_LEVEL
fi
AM_INIT_AUTOMAKE(flower, $FULL_VERSION)

AC_PROG_CC
AC_PROG_CXX


# turn off shared libraries by default (may be enabled using --enable-shared)
AM_DISABLE_SHARED
AM_PROG_LIBTOOL

printing_b=no
checking_b=yes
optimise_b=no
profile_b=no

AC_ARG_ENABLE(printing,
    [  enable-printing         turn on debug printing. Default: off],
    [printing_b=$enableval])

AC_ARG_ENABLE(checking,
    [  enable-checking         set runtime checks (assert calls). Default: on],
    [checking_b=$enableval] )

AC_ARG_ENABLE(optimise,
    [  enable-optimise         use maximal speed optimisations. Default: off],
    [optimise_b=$enableval])
    
AC_ARG_ENABLE(profiling, 
    [  enable-profiling        compile with gprof support. Default: off],
    [profile_b=$enableval])
    
if test $printing_b = no; then
    AC_DEFINE(NPRINT)
fi
    
if test $checking_b = no; then
    AC_DEFINE(NDEBUG)
fi

if test $optimise_b = yes; then
#    DEFINES="$DEFINES -finline-functions -O2 -DSTRING_UTILS_INLINED"
    AC_DEFINE(STRINGS_UTILS_INLINED)
fi

# oeps, broken for now
if test $profile_b = yes; then
    EXTRA_LIBES="-pg"
    DEFINES="$DEFINES -pg"
fi

AC_LANG_CPLUSPLUS

LIB_SUFFIX=.a
MODULE_CXXFLAGS="$MODULE_CXXFLAGS -D_REENTRANT"

AC_SUBST(MODULE_CXXFLAGS)
AC_SUBST(MODULE_LDFLAGS)
AC_SUBST(LIB_SUFFIX)

# AC_SUBST(FULL_VERSION)
# AC_SUBST(MAJOR_VERSION)
# AC_SUBST(MINOR_VERSION)
# AC_SUBST(PATCH_LEVEL)
# AC_SUBST(MY_PATCH_LEVEL)

# libtool.info ...
# **Never** try to set library version numbers so that they correspond
# to the release number of your package.  This is an abuse that only
# fosters misunderstanding of the purpose of library versions.

REVISION=$PATCH_LEVEL
# CURRENT=$MINOR_VERSION
CURRENT=`expr $MINOR_VERSION + 1`
# AGE=$(expr $MAJOR_VERSION + 1)
AGE=$MAJOR_VERSION
AC_SUBST(CURRENT)
AC_SUBST(REVISION)
AC_SUBST(AGE)
AC_SUBST(PERL)

AC_FUNC_MEMCMP
AC_FUNC_VPRINTF
AC_CHECK_FUNCS(memmem snprintf )

AC_DEFINE_UNQUOTED(MODULE_VERSION, "${FULL_VERSION}")

touch stamp-h.in
AM_CONFIG_HEADER(config.hh:config.hh.in)
AC_OUTPUT(Makefile include/Makefile test/Makefile)

