\input texinfo @c -*-texinfo-*-
@setfilename compiling.info
@settitle Compiling LilyPond on Windows

@html
<!--- @@WEB-TITLE@@=Windows Compilation --->
@end html

@section Obtaining LilyPond

You can get the latest version of LilyPond at
@uref{ftp://ftp.lilypond.org/pub/LilyPond/,
ftp://ftp.lilypond.org/pub/LilyPond/}.

@section Windows build requirements
You need the following packages to compile Lilypond on Windows.

@table @code
@item The GNU + Cygnus tools, 1.3.10 or newer.
Check out the @uref{http://cygwin.com,Cygwin webpage}.
You can get the latest version of the GNU + Cygnus tools from cygnus
@uref{http://cygwin.com/mirrors.html,mirror site}.
@end table

@subsection Cross compiling

These binaries are cross compiled for Windows on a GNU/Linux box using
mknetrel.  Get it from:
@quotation
@example
     cvs -d:pserver:anoncvs@@sources.redhat.com:/cvs/cygwin-apps co mknetrel
@end example
@end quotation

If your distribution does not include a Cygwin cross building
environment, you can quite easily create one using mknetrel.
Apply
@uref{http://lilypond.org/people/jan/cygwin/mknetnel/mknetrel-cross-tools-.patch,this
patch}, and read @file{CROSS-TOOLS}.

Although mknetrel is well suited for this, the mknetrel maintainer
does not see any reason to include this patch.

You can also get
@uref{http://lilypond.org/lilypond/cygwin/i386-gnu-linux-x-i686-pc-cygwin,
precompiled binaries for GNU/Linux ix68}.

@subsection Compiling on Windows

Compiling on Windows should be possible, but how should we know?  If
you have any experiences you want to share, please do so at
@uref{http://lilypond.org/wiki?CompilingOnWindows,Compiling on
Windows}.  Or write to one of the mailing lists.

@section Windows installation specifics

Installing LilyPond on Windows is similar to a unix installation, but
needs a number of extra tricks.  All code for these tricks can be
found in LilyPond's mknetrel build script in the source package
directory @file{cygwin/mknetrel}.


@section The LilyPond installer

The LilyPond installer will probably be dropped real soon now.  It's a
patched version of the Cygwin installer.  Get it from:

@quotation
@example
     cvs -d:pserver:anoncvs@@sources.redhat.com:/cvs/cygwin-apps co setup
@end example
@end quotation

and apply @uref{http://lilypond.org/cygwin/cygwin-installer.patch,this patch}.

Here's how I did it:
@quotation
@example
    CYGWIN=$HOME/cygwin  # where your cygwin lives
    cd $CYGWIN
    wget ftp://ftp.sf.net/pub/sourceforge/mingw/gcc-2.95.3-20010828.tar.gz
    wget ftp://ftp.sf.net/pub/sourceforge/mingw/w32api-1.4.tar.gz
    mkdir -p usr/mingw
    cd usr/mingw
    tar xzf ../../gcc-2.95.3-20010828.tar.gz
    tar xzf ../../w32api-1.4.tar.gz
    cd ../..
    rm -f linux-x-cygwin/usr/lib/mingw
    ln -s ../../../usr/mingw/lib linux-x-cygwin/usr/lib/mingw
    rm -f linux-x-cygwin/usr/include/mingw
    ln -s ../../../usr/mingw/include linux-x-cygwin/usr/include/mingw
    cp usr/lib/mingw/crt2.o linux-x-cygwin/usr/lib/mingw

    cd $HOME/usr/src
    export CVSROOT=:pserver:anoncvs@@anoncvs.cygnus.com:/cvs/cygwin-apps
    touch $HOME/.cvspass
    cvs login
    cvs -z3 -r setup-200206 setup
    cd setup
    patch < $HOME/cvs/savannah/lilypond/Documentation/windows/cygwin-installer.patch
    cp $HOME/cvs/lilypond/Documentation/windows/LilyPond.ico .
    CPPFLAGS="-I$CYGWIN/usr/include/mingw \
                -I$CYGWIN/usr/mingw/mingw32/include \
		-I$CYGWIN/usr/mingw/include/g++-3" \
		CFLAGS='-mno-cygwin' \
		CXXFLAGS='-mno-cygwin' \
		LDFLAGS="-L$CYGWIN/usr/lib/mingw \
		-L$CYGWIN/usr/mingw/lib/gcc-lib/mingw32/2.95.3-6/" \
 	./configure  --host=i686-pc-mingw32 \
	--disable-shared --enable-dependencies --enable-maintainer-mode 
    make WINDRES="windres --include-dir $CYGWIN/usr/include/w32api"
    cp -pv setup.exe $CYGWIN/dist/cygwin-1.3.10/new-setup.exe
    strip $CYGWIN/dist/cygwin-1.3.10/new-setup.exe
@end example
@end quotation
