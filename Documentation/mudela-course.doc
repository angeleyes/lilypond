% -*-LaTeX-*-
% this document should be run through the mudela-book script after lilypond
% has been installed.


\documentclass{article}
\usepackage{a4wide}
\title{Mudela and LilyPond crash course}
\author{Han-Wen Nienhuys}
\date{October 20, 1997}
\def\file#1{{\texttt{#1}}}

\begin{document}
\maketitle
\def\interexample{\par Produces the following:\par}
\def\preexample{\par\medskip}
\def\postexample{\par\medskip}

\emph{This document is not complete yet. It's just a brief blurb which
  skims some features of Mudela}

\section{Who is who}

This document describes various  things, but let's first point out the
different parts of the package, and their names.
\begin{description}
\item[Mudela] A language for defining music.
\item[LilyPond] A package (the only one existing :-) which can 
  read a mudela file and interpret it. 
\item[Feta] A (Meta)Font of musical symbols.  LilyPond uses it to
  render sheet music.
\end{description}

\section{Overview}

Let's start with a very simple example, we will enter ``twinkle
twinkle little star.''  We start with the most important part: the
notes.

Imagine being in a music-lesson, and that you made an error playing
``twinkle twinkle''.  Your teacher asks you to read out loud the
melody of the song, just to verify your eyesight.  You would probably
say something like
\begin{quote}
  A quarter note C, Another quarter note C, a quarter G, another one, etc.
\end{quote}

Mudela tries to capture this verbal presentation of sheet music, in
the following way.  The first line of twinkle twinkle is written in
as follows
\begin{verbatim}
c4 c4 g4 g4 a4 a4 g2
f4 f4 e4 e4 d4 d4 c2
\end{verbatim}

The notes are entered with names (a, b, c) combined with numbers
(2,4).  The names designate the pitches, the numbers the durations: 4
is a quarter note, 2 a half note, etc.

Now all we have to specify what should be done with the music.  We
want a paper version, so we combine the music with a ``output this on
paper'' statement.  These two are combined in ``score'' block.  This
is the final result with its output.   We add a comment (the line
starting with \verb+%+).
Put this into a file
called \file{twinkle.ly}

\begin{verbatim}

% twinkle, v1
\score {
        \melodic { 
                c4 c4 g4 g4 a4 a4 g2
                f4 f4 e4 e4 d4 d4 c2
        }
        \paper {}
} 
\end{verbatim}

there are a few things to note about this example:

The braces are grouping characters. In general, in mudela data entry
for a data section called ``foobar'' looks like this:

\begin{verbatim}
\foobar { ...... }
\end{verbatim}

To see if it actually works, we run it through LilyPond.  Invoke the
command 
\begin{verbatim}
        lilypond twinkle.ly
\end{verbatim}
When LilyPond starts working it will produce various ``operator
pacification'' messages, which you can safely ignore for now.  The run
should have left a file called \file{lelie.tex} in your working
directory.  You can process that file with \TeX, and it will look like
this:

\begin{mudela}
\score {
        \melodic { 
                c4 c4 g4 g4 a4 a4 g2
                f4 f4 e4 e4 d4 d4 c2
        }
        \paper {}
} 
\end{mudela}

As you can see, this is the song that we wanted, albeit a little
low-pitched.  You would probably want a version of the song which has
all notes an octave higher.  This can be done by adding a
\verb+\octave+ command to the source.  This sets the default octave
for all notes.  Another convenience is the default duration: if you do
not specify a duration with the notename, the last explicitly entered
is used.  The improved version reads thus


\begin[verbatim]{mudela}
  % twinkle v2
\score {
        \melodic { 
                \octave c';
                c4 c g g a a g2
                f4 f e e d d c2
        }
        \paper {}
} 
\end{mudela}

 

FIXME rewrite starting here.

\begin[verbatim]{mudela}
  \score {
        \melodic {      % {...} is a voice
        c'4 g'4         % c and g are pitches, 4 is the duration
                        % (crotchet/quarter note)
        c''4 ''c4       % c' is 1 octave up, 'c 1 down.
        <c'4 g'4>       % <...> is a chord
        }
} 
\end{mudela}


\begin[fragment,verbatim]{mudela}
  { c4 e4 g4 }
\end{mudela} 

Basics: the \verb+%+ introduces a comment. All music is inside a
\verb+\score+ block which represents one movement, ie one contiguous
block of music.  Voices are grouped by \verb+{+ and \verb+}+ and
chords by \verb+<+ and \verb+>+.


The \verb+\octave+ command controls the default pitch (octave). If you
do not specify duration, the last one entered is used.  The
\verb+\paper+ block contains parameters for spacing and dimensions.

\begin[verbatim]{mudela}
\score {
        % twinkle twinkle little star
        \melodic { 
                \octave c';
                c4 c g g a a g2
                f4 f e e d [d8. e16] c2
                
        }
        \paper { linewidth = 5.\cm; }
}
\end{mudela}

A more complex example; The multi command controls at what level the
different components of a chord are interpreted.  The LilyPond chord
is much more general than a traditional chord.  Multiple voices on a
staff are entered as a chord of voices.  A score is a chord of staffs,
etc.

\begin[verbatim]{mudela}
        
\score{
  \melodic 
    { \octave c'; c4 c4 
       \multi 1 <  { c2 c2 } { c'2 c'2 } > 
       \multi 2 <  { \stemdown c2 c2 } { \stemup c'2 c'2 } > 
       \multi 3 <
        { \clef "bass"; c2 c2 }
        { \meter 2/4;\bar "||";
          \key fis cis gis; c'2 c'2 } > 
         c2 c1 
      c1 c1
       \multi 1< \multi 3 <
      { \meter 2/4; \clef "violin"; c2 c2 }
        { \meter 2/4; \clef "bass"; c2 c2 }
      >
      \multi 3 <
        { \meter 2/4; \clef "violin"; c2 c2 }
        { \meter 2/4; \clef "bass"; c2 c2 }
      >
      >
    }
}

\end{mudela}


LilyPond is designed to handle complicated stuff automatically.
Expertise should be in the program, not in the user.

The following example shows how multiple voices on the same staff are
handled graciously (well, somewhat). If the noteheads of different
voices collide, they are moved horizontally. Rests are moved
vertically.

[FIXME]
\def\bla{
\begin[verbatim]{mudelaXX}
two_voice = \melodic 
         \multi 2 <
          {     \octave c'; \stemdown
                c4 d e f g2~  g4 a [c8 d e f] c2| }
          { \stemup
                g4 f e g ~ g2 g2  c4 g4 g2 } 

        >

two_voice_steminvert = \melodic 
        \multi 2 <  
          {     \octave c'; \stemup
% the f and g on 4th beat are exceptionally ugh.
                c4 d e f g2 g4 a | }
          { \stemdown
                g4 f e g  g2 g2 } 

        >

three_voice = \melodic 
        \multi 2 <
        { \stemup 
                g4 f e f g a g2 }
        { \property Voice.hshift = 1 \stemup 
                e2  e2  e2  e2 }
        { \stemdown
                c4 d e d c d es }
        >


restsII = \melodic {
        \octave c'; 
                        \multi2 <
                                { \stemup  g'8 f' e' d' c' b a g f e d c }
                                { \stemdown r  r  r  r  r  r r r r r r r }
                        >
                        r8 r4
                        \multi 2 <  r8 r8 >
                        \multi 2 <  r8 r8 r8 >
                        \multi 2 <  r8 r8 r8 r8 >
                        \multi 2 <  r r >
                        \multi 2 <  r r r >
                        \stemup
                        [c''8 r8 c''8 c''8]
                        [c8 r8 c8 c8]
}

\score{
        \melodic {  \$two_voice  \$two_voice_steminvert 
                        \$three_voice  \restsII }
}

}
\end{document}
